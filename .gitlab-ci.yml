variables:
  GIT_STRATEGY: clone
  GIT_SUBMODULE_STRATEGY: recursive
stages:
    - build 
    - test
    - performance
    - documentation
image: gcc
before_script:
 - apt-get update 
 - apt-get -y install cmake 
 - apt-get -y install libpython3.9-dev
 - apt-get -y install doxygen
 - apt-get -y install gcovr
CoMMA:
    stage: build
    script:
        - mkdir build
        - cd build
        - cmake ..
        - make
    artifacts:
        paths:
        - build/
test_a:
    stage: test
    needs: [CoMMA]
    script:
        - cd build
        - ./Comma_test -r junit > test_a.xml
        - gcovr --xml-pretty --exclude '\.\./pybind11/' --exclude '\.\./Catch2/' --print-summary -o coverage.xml --root ..
    coverage: /^\s*lines:\s*\d+.\d+\%/
    artifacts:
        reports:
            junit: build/test_a.xml
            coverage_report:
                coverage_format: cobertura
                path: build/coverage.xml
pages:
    stage: documentation
    script:
        - doxygen Documentation/Doxyfile
        - mv documentation/html/ public/
    artifacts:
        paths:
            - public
    rules:
           - if: $CI_COMMIT_REF_NAME == $CI_DEFAULT_BRANCH





